# アイゼンハワー・マトリックスタスク管理アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的
- HTMXとFastAPIの技術習得
- 実用的なタスク管理アプリの開発
- Obsidianへのエクスポート機能の実装

### 1.2 技術スタック
- **フロントエンド**: HTML + HTMX + Sortable.js + CSS
- **バックエンド**: FastAPI (Python)
- **データベース**: SQLite
- **テンプレートエンジン**: Jinja2

### 1.3 開発環境
- Python 3.9+
- 仮想環境（venv）
- ローカル開発環境

---

## 2. 機能要件

### 2.1 タスク管理機能

#### 2.1.1 タスクの表示
- **4象限のマトリックス表示**
  - 第1象限：緊急かつ重要（今すぐ対応）
  - 第2象限：重要だが緊急でない（計画的に）
  - 第3象限：緊急だが重要でない（委任・削減）
  - 第4象限：緊急でも重要でもない（削除）

- **各象限の特徴**
  - カード型のタスク表示
  - ドラッグ&ドロップで移動可能
  - インライン編集可能

#### 2.1.2 タスクの追加
- **フォーム入力**
  - タイトル（必須）
  - 説明（任意）
  - 期限（任意）
  - 象限の選択（手動、1-4から選択）

- **実装方法**
  - HTMXの `hx-post` でフォーム送信
  - ページ遷移なしでタスクを追加
  - 該当象限のみ部分更新

#### 2.1.3 タスクの編集
- **インライン編集**
  - タイトル、説明、期限を直接編集
  - HTMXの `hx-put` または `hx-patch` で更新
  - 編集後、自動で保存

#### 2.1.4 タスクの削除
- **削除機能**
  - 削除ボタンで即座に削除
  - 確認なしで削除（HTMXでスムーズに）
  - HTMXの `hx-delete` で実装

#### 2.1.5 タスクの完了/未完了
- **完了状態の切り替え**
  - チェックボックスで切り替え
  - HTMXの `hx-patch` で状態更新
  - 完了済みタスクの表示方法（要確認）

#### 2.1.6 ドラッグ&ドロップ
- **象限間の移動**
  - Sortable.jsでドラッグ&ドロップUI
  - ドロップ時にHTMXでサーバーに送信
  - FastAPIで象限を更新
  - 部分更新で反映

### 2.2 エクスポート機能

#### 2.2.1 Obsidian形式のMarkdownエクスポート
- **エクスポート形式**
  ```markdown
  # アイゼンハワー・マトリックス
  エクスポート日時: 2024-01-02 10:00:00

  ## 第1象限：緊急かつ重要（今すぐ対応）

  ### [ ] タスク1
  - 説明: これは重要なタスクです
  - 期限: 2024-01-15
  - 作成日: 2024-01-01

  ## 第2象限：重要だが緊急でない（計画的に）
  ...
  ```

- **エクスポート内容**
  - 各象限ごとにセクション分け
  - タスクのタイトル、説明、期限
  - 完了済みタスクの表示/非表示オプション（要確認）
  - エクスポート日時

- **実装方法**
  - ボタンクリックでダウンロード
  - FastAPIでMarkdownを生成
  - HTMXで部分更新（エクスポートボタンだけ更新）

---

## 3. 非機能要件

### 3.1 UI/UX

#### 3.1.1 デザイン
- **Notion風のシンプルなデザイン**
  - クリーンでミニマル
  - カード型のタスク表示
  - 柔らかい色合い
  - 適度な余白

#### 3.1.2 色分け（象限）
- **第1象限**: 赤系（緊急かつ重要）
- **第2象限**: 青系（重要だが緊急でない）
- **第3象限**: 黄系（緊急だが重要でない）
- **第4象限**: グレー系（緊急でも重要でもない）

#### 3.1.3 レスポンシブ対応
- デスクトップ優先
- モバイル対応は後回し（要確認）

### 3.2 パフォーマンス
- ページ遷移なしの部分更新（HTMX）
- 高速なレスポンス（FastAPIの非同期処理）

### 3.3 データ管理
- SQLiteデータベース
- 単一ユーザー想定
- データの永続化

---

## 4. データ構造

### 4.1 タスクテーブル（SQLite）

```sql
CREATE TABLE tasks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    description TEXT,
    quadrant INTEGER NOT NULL CHECK(quadrant IN (1, 2, 3, 4)),
    completed BOOLEAN DEFAULT 0,
    due_date TEXT,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);
```

### 4.2 データモデル（Python）

```python
class Task:
    id: int
    title: str
    description: str | None
    quadrant: int  # 1-4
    completed: bool
    due_date: str | None
    created_at: str
    updated_at: str
```

---

## 5. API設計

### 5.1 エンドポイント一覧

| メソッド | エンドポイント | 説明 | HTMX属性 |
|---------|--------------|------|---------|
| GET | `/` | メインページ | - |
| GET | `/api/tasks` | タスク一覧取得 | `hx-get` |
| POST | `/api/tasks` | タスク追加 | `hx-post` |
| PUT | `/api/tasks/{id}` | タスク更新 | `hx-put` |
| PATCH | `/api/tasks/{id}` | タスク部分更新 | `hx-patch` |
| DELETE | `/api/tasks/{id}` | タスク削除 | `hx-delete` |
| GET | `/api/export` | Obsidian形式でエクスポート | `hx-get` |

### 5.2 レスポンス形式
- HTML（HTMX用）
- JSON（API用、必要に応じて）

---

## 6. 実装の優先順位

### Phase 1: 基本機能
1. ✅ プロジェクトセットアップ
2. ✅ データベース設計・作成
3. ✅ タスクの追加・表示
4. ✅ 4象限のマトリックス表示
5. ✅ タスクの編集・削除

### Phase 2: ドラッグ&ドロップ
6. ✅ Sortable.jsの統合
7. ✅ 象限間の移動機能

### Phase 3: エクスポート
8. ✅ Obsidian形式のMarkdown生成
9. ✅ ダウンロード機能

### Phase 4: 改善
10. ⬜ 完了済みタスクの表示方法
11. ⬜ UI/UXの改善
12. ⬜ エラーハンドリング

---

## 7. ファイル構成

```
プロジェクト/
├── app.py                 # FastAPIアプリ
├── models.py              # データモデル（Pydantic）
├── database.py            # データベース接続・操作
├── templates/
│   └── index.html        # メインページ（HTMX）
├── static/
│   ├── style.css         # スタイル（Notion風）
│   └── sortable.js       # ドラッグ&ドロップ（CDNでも可）
├── tasks.db              # SQLiteデータベース
├── requirements.txt      # 依存パッケージ
└── Docs/
    └── 要件定義書.md     # このファイル
```

---

## 8. 技術的な実装詳細

### 8.1 HTMXの使用箇所

#### タスク追加
```html
<form hx-post="/api/tasks" hx-target="#quadrant-1" hx-swap="beforeend">
  <!-- フォーム内容 -->
</form>
```

#### タスク編集
```html
<div hx-put="/api/tasks/1" hx-trigger="blur">
  <!-- 編集可能なコンテンツ -->
</div>
```

#### タスク削除
```html
<button hx-delete="/api/tasks/1" hx-target="#task-1" hx-swap="outerHTML">
  削除
</button>
```

#### ドラッグ&ドロップ後の更新
```javascript
// Sortable.jsのonEndイベントでHTMXを呼び出す
onEnd: function(evt) {
  htmx.ajax('PATCH', '/api/tasks/' + taskId, {
    values: {quadrant: newQuadrant}
  });
}
```

### 8.2 FastAPIの実装方針

- **非同期処理**: `async def` を使用
- **Pydanticモデル**: リクエスト/レスポンスのバリデーション
- **HTMLResponse**: HTMX用にHTMLを返す
- **SQLite**: `aiosqlite` または `sqlite3` を使用

---

## 9. 確認事項・未決定事項

### 9.1 要確認事項
- [ ] 完了済みタスクの表示方法（非表示/グレーアウト/別セクション）
- [ ] タスクの詳細情報（説明、期限）の必須/任意
- [ ] モバイル対応の必要性

### 9.2 将来の拡張機能（検討）
- タグ機能
- タスクの検索・フィルタリング
- 複数ユーザー対応
- データのインポート機能

---

## 10. 参考資料

### 10.1 技術ドキュメント
- [HTMX公式ドキュメント](https://htmx.org/)
- [FastAPI公式ドキュメント](https://fastapi.tiangolo.com/)
- [Sortable.js公式ドキュメント](https://sortablejs.github.io/Sortable/)

### 10.2 デザイン参考
- Notion UI/UX
- アイゼンハワー・マトリックスの概念

---

**作成日**: 2024-01-02  
**最終更新**: 2024-01-02  
**バージョン**: 1.0

